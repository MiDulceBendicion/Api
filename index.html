<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta DNI - API Per√∫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 380px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #0056b3;
    }
    .resultado {
      margin-top: 15px;
      padding: 10px;
      background: #eef;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Consulta DNI</h2>
    <input type="text" id="dni" placeholder="Ingrese DNI (8 d√≠gitos)">
    <button onclick="consultarDNI()">Buscar</button>
    <div id="resultado" class="resultado"></div>
  </div>

  <script>
    function calcularEdad(fecha) {
      const hoy = new Date();
      const nacimiento = new Date(fecha);
      let edad = hoy.getFullYear() - nacimiento.getFullYear();
      const m = hoy.getMonth() - nacimiento.getMonth();
      if (m < 0 || (m === 0 && hoy.getDate() < nacimiento.getDate())) {
        edad--;
      }
      return edad;
    }

    async function consultarDNI() {
      const dni = document.getElementById("dni").value.trim();
      const resultado = document.getElementById("resultado");

      if (!/^\d{8}$/.test(dni)) {
        resultado.innerHTML = "‚ö†Ô∏è El DNI debe contener exactamente 8 n√∫meros.";
        return;
      }

      try {
        const response = await fetch(`https://apiperu.dev/api/dni/${dni}`, {
          headers: {
            "Authorization": "Bearer TU_TOKEN_AQUI" // üîë coloca aqu√≠ tu token real
          }
        });

        const data = await response.json();

        if (data.success) {
          const persona = data.data;
          let edadTexto = persona.fecha_nacimiento 
            ? calcularEdad(persona.fecha_nacimiento) + " a√±os" 
            : "No disponible";

          // Mostrar en pantalla
          resultado.innerHTML = `
            DNI: ${persona.numero}<br>
            Nombre: ${persona.nombre_completo}<br>
            Fecha de Nacimiento: ${persona.fecha_nacimiento || "No disponible"}<br>
            Edad: ${edadTexto}
          `;

          // Guardar en consultas.txt
          fetch("guardar.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              dni: persona.numero,
              nombre: persona.nombre_completo,
              fecha_nacimiento: persona.fecha_nacimiento,
              edad: edadTexto
            })
          })
          .then(res => res.text())
          .then(res => console.log(res))
          .catch(err => console.error("Error al guardar:", err));

        } else {
          resultado.innerHTML = "‚ùå No se encontr√≥ informaci√≥n.";
        }
      } catch (error) {
        resultado.innerHTML = "‚ö†Ô∏è Error en la consulta.";
        console.error(error);
      }
    }
  </script>
</body>
</html>
